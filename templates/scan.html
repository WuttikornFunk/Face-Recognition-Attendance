<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Face Scan - Face Attendance</title>
  <style>
    @keyframes pulse-border{0%,100%{border-color:rgba(59,130,246,.3)}50%{border-color:rgba(59,130,246,.8)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    :root{
      --bg:#0f172a;
      --white:#e5e7eb;
      --muted:#9ca3af;
      --glass-bg:rgba(17,24,39,.3);
      --glass-border:rgba(148,163,184,.3);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;width:100%}
    body{
      background:var(--bg);
      color:var(--white);
      font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
      display:flex;align-items:center;justify-content:center;
      min-height:100vh;padding:20px;
      -webkit-font-smoothing:antialiased;
    }
    /* header navigation */
    .nav-top{
      position:fixed;top:0;left:0;right:0;z-index:100;
      background:linear-gradient(to bottom, rgba(15,23,42,.8), transparent);
      backdrop-filter:blur(8px);
      padding:20px 32px;
      display:flex;justify-content:space-between;align-items:center;
      border-bottom:1px solid rgba(148,163,184,.1);
    }
    .nav-brand{
      font-weight:800;letter-spacing:.05em;font-size:0.95rem;
      background:linear-gradient(135deg, #e5e7eb 0%, #9ca3af 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      text-transform:uppercase;
    }
    .nav-links{display:flex;gap:12px}
    .nav-link{
      padding:8px 16px;border-radius:8px;
      background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);
      color:var(--white);text-decoration:none;font-size:0.85rem;
      transition:all .2s;font-weight:600;
    }
    .nav-link:hover{background:rgba(59,130,246,.2);border-color:rgba(59,130,246,.7)}
    /* main scan container */
    .scan-container{
      width:100%;max-width:600px;
      background:var(--glass-bg);
      backdrop-filter:blur(12px);
      border:1.5px solid var(--glass-border);
      border-radius:24px;padding:48px 32px;
      box-shadow:0 25px 50px rgba(2,6,23,.5), 0 0 40px rgba(59,130,246,.1);
      animation:float 3s ease-in-out infinite;
      margin-top:80px;
    }
    .scan-title{
      font-size:2rem;font-weight:800;letter-spacing:.02em;
      margin-bottom:12px;text-align:center;
      background:linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    }
    .scan-desc{
      color:var(--muted);text-align:center;margin-bottom:40px;
      font-size:0.95rem;line-height:1.6;
    }
    /* camera preview area */
    .preview-box{
      width:100%;aspect-ratio:4/3;border-radius:16px;
      background:linear-gradient(135deg, rgba(17,24,39,.4) 0%, rgba(2,6,23,.3) 100%);
      border:2px dashed rgba(59,130,246,.3);
      display:flex;align-items:center;justify-content:center;
      margin-bottom:28px;overflow:hidden;
      position:relative;
    }
    .preview-box img{width:100%;height:100%;object-fit:cover}
    .preview-placeholder{
      color:var(--muted);text-align:center;font-size:0.9rem;
    }
    /* scan button */
    .scan-btn{
      width:100%;padding:16px 24px;
      background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color:#fff;border:none;border-radius:12px;
      font-size:1rem;font-weight:700;letter-spacing:.02em;
      cursor:pointer;transition:all .3s;
      text-transform:uppercase;box-shadow:0 8px 24px rgba(59,130,246,.3);
      margin-bottom:16px;
    }
    .scan-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 32px rgba(59,130,246,.4);
      background:linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    }
    .scan-btn:active{transform:translateY(0)}
    /* result display */
    .result-box{
      min-height:60px;padding:16px;border-radius:12px;
      background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);
      text-align:center;color:var(--white);
      font-size:0.9rem;line-height:1.5;
      display:none;
    }
    .result-box.show{display:block;animation:slideIn .3s ease-out}
    @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    /* mobile */
    @media (max-width:640px){
      .nav-top{padding:16px 20px;gap:12px}
      .nav-brand{font-size:0.85rem}
      .nav-links{gap:8px}
      .nav-link{padding:6px 12px;font-size:0.75rem}
      .scan-container{padding:32px 24px;margin-top:70px;max-width:100%}
      .scan-title{font-size:1.5rem}
      .scan-desc{font-size:0.85rem;margin-bottom:24px}
      .preview-box{margin-bottom:20px}
      .scan-btn{padding:14px 20px;font-size:0.95rem}
    }
  </style>
</head>
<body>
  <!-- Top Navigation -->
  <div class="nav-top">
    <div class="nav-brand">üîê Face Scan</div>
    <div class="nav-links">
      <a href="{{ url_for('index') }}" class="nav-link">üèöÔ∏è Home</a>
      <a href="{{ url_for('enroll') }}" class="nav-link">‚ûï Register</a>
      <a href="{{ url_for('logs') }}" class="nav-link">üìù History</a>
    </div>
  </div>

  <!-- Main Scan Section -->
  <div class="scan-container">
    <h1 class="scan-title">Face Scan</h1>
    <p class="scan-desc">Position your face in the camera and press the button below to scan and record attendance.</p>

    <!-- Camera Preview / Live Stream -->
    <div class="preview-box" id="preview">
      <img src="{{ url_for('video_feed') }}" alt="Live camera feed" id="cam-stream">
    </div>

    <!-- Status Display -->
    <div style="text-align:center;margin-bottom:20px">
      <p id="status-text" style="color:var(--muted);font-size:0.9rem">üîç Scanning face...</p>
    </div>

    <!-- Result Display -->
    <div class="result-box" id="result"></div>
  </div>

  <script>
    function startScan(){
      const result = document.getElementById('result');
      const statusText = document.getElementById('status-text');
      
      statusText.textContent = '‚è≥ Processing scan...';
      result.classList.remove('show');
      
      try{
        fetch('/api/checkin_once', {method:'POST'})
          .then(res => res.json())
          .then(data => {
            if(data.ok && data.name !== 'unknown'){
              result.style.background = 'rgba(34,197,94,.1)';
              result.style.borderColor = 'rgba(34,197,94,.5)';
              result.innerHTML = `‚úÖ <strong>${data.name}</strong><br>Attendance recorded (${data.message})`;
              statusText.textContent = '‚úì Scan complete!';
            } else {
              result.style.background = 'rgba(239,68,68,.1)';
              result.style.borderColor = 'rgba(239,68,68,.5)';
              result.innerHTML = '‚ùå Face not recognized.<br>Please register first.';
              statusText.textContent = '‚ö†Ô∏è Face not recognized';
            }
            result.classList.add('show');
          })
          .catch(e => {
            result.style.background = 'rgba(107,114,128,.1)';
            result.style.borderColor = 'rgba(107,114,128,.5)';
            result.innerHTML = '‚ö†Ô∏è Error: ' + (e.message || 'Unknown error');
            result.classList.add('show');
            statusText.textContent = '‚ùå Error occurred';
          });
      }catch(e){
        result.style.background = 'rgba(107,114,128,.1)';
        result.style.borderColor = 'rgba(107,114,128,.5)';
        result.innerHTML = '‚ö†Ô∏è Error: ' + (e.message || 'Unknown error');
        result.classList.add('show');
        statusText.textContent = '‚ùå Error occurred';
      }
    }
    
    // Auto-start scan on page load
    window.addEventListener('load', function(){
      setTimeout(startScan, 500);
    });
  </script>
</body>
</html>